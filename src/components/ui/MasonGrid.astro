---
import DirectusImage from '@/components/ui/DirectusImage.astro';
import Link from '@/components/ui/Link.astro';
import type { Posts } from '@/types/directusCollection';

interface Props {
  posts: Posts[];
  class?: string;
}

const { posts, class: className } = Astro.props;

function getSummary(post: Posts): string {
  const raw = (post.description || post.content || '') as string;
  if (!raw) return '';
  // Strip HTML tags if content is rich text
  const text = raw.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
  return text;
}
---

<div class={`mason-grid w-full ${className || ''}`}>
  <div class="columns-1 md:columns-2 lg:columns-3" style="column-gap: 1.5rem;">
    {posts.map((post) => (
      <div class="mb-6 break-inside-avoid rounded-xl overflow-hidden bg-white shadow-sm hover:shadow-lg transition-all duration-300 hover:scale-[1.02]">
        <Link href={`/post/${post.slug}`}>
          {post.image && (
            <DirectusImage
              imageId={post.image}
              alt={post.title || 'Post image'}
              class="w-full h-auto block object-cover hover:scale-[1.01] transition-transform duration-300"
            />
          )}
          <div class="p-6">
            <h3 class="text-xl font-semibold tracking-tight text-gray-900 mb-2 hover:text-blue-600 transition-colors">
              {post.title}
            </h3>
            {getSummary(post) && (
              <p class="text-sm text-gray-600 line-clamp-3 mb-3">
                {post.description}
              </p>
            )}
            {post.published_at && (
              <div class="text-xs text-gray-500">
                {new Date(post.published_at).toLocaleDateString()}
              </div>
            )}
          </div>
        </Link>
      </div>
    ))}
  </div>
</div>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
