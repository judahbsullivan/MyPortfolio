---
import type { HTMLAttributes } from "astro/types";
import DirectusImage from "./DirectusImage.astro";

type CardItem = {
  slug?: string | null;
  title?: string | null;
  description?: string | null;
  image?: string | null;
  published_at?: string | null;
};

interface Props extends HTMLAttributes<"div"> {
  posts: CardItem[];
  base?: 'post' | 'project';
}

const { posts, base = 'post', class: className, ...rest } = Astro.props as Props;
---

<div class={`carousel-grid relative overflow-hidden ${className || ''}`} {...rest}>
  <div class="carousel-track flex items-end justify-center">
    {posts.map((item, index) => (
      <div class="carousel-item flex-shrink-0 mx-4" style="width: 400px;" data-index={index}>
        <div class="carousel-image-container relative overflow-hidden rounded-lg">
          {item.image && (
            item.image.startsWith('http') ? (
              <img 
                src={item.image} 
                alt={item.title || 'Post image'} 
                class="carousel-image w-full h-full object-cover"
                style={`width: ${300 + (index % 4) * 50}px; aspect-ratio: ${1.2 + (index % 4) * 0.2};`}
                loading="lazy" 
              />
            ) : (
              <DirectusImage 
                imageId={item.image} 
                alt={item.title || 'Post image'} 
                class="carousel-image w-full h-full object-cover"
              />
            )
          )}
        </div>
      </div>
    ))}
    
    {/* Duplicate items for seamless loop */}
    {posts.map((item, index) => (
      <div class="carousel-item flex-shrink-0 mx-4" style="width: 400px;" data-index={`duplicate-${index}`}>
        <div class="carousel-image-container relative overflow-hidden rounded-lg">
          {item.image && (
            item.image.startsWith('http') ? (
              <img 
                src={item.image} 
                alt={item.title || 'Post image'} 
                class="carousel-image w-full h-full object-cover"
                style={`width: ${300 + (index % 4) * 50}px; aspect-ratio: ${1.2 + (index % 4) * 0.2};`}
                loading="lazy" 
              />
            ) : (
              <DirectusImage 
                imageId={item.image} 
                alt={item.title || 'Post image'} 
                class="carousel-image w-full h-full object-cover"
              />
            )
          )}
        </div>
      </div>
    ))}
  </div>
</div>

<style>
  .carousel-grid {
    width: 100%;
  }
  
  .carousel-track {
    animation: scroll 25s linear infinite;
  }
  
  @keyframes scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  
  .carousel-image-container {
    background: #f3f4f6;
  }
  
  .carousel-image {
    transition: transform 0.3s ease;
  }
  
  .carousel-image:hover {
    transform: scale(1.05);
  }
</style> 
