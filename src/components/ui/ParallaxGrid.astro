---
import DirectusImage from '@/components/ui/DirectusImage.astro';
import Link from '@/components/ui/Link.astro';

type CardItem = {
  slug?: string | null;
  title?: string | null;
  description?: string | null;
  image?: string | null;
  published_at?: string | null;
};

interface Props {
  posts: CardItem[];
  class?: string;
  base?: 'post' | 'project';
}

const { posts, class: className, base = 'post' } = Astro.props as Props;
---

<div class={`space-y-4 md:space-y-8 w-full px-4 md:px-6 ${className || ''}`}>
  {posts.map((post, index) => (
    <div class="parallax-item relative" data-index={index}>
      <!-- Image Container -->
      <div class="parallax-container relative w-full max-w-4xl mx-auto aspect-video overflow-hidden rounded-lg sm:rounded-xl md:rounded-2xl mb-4">
        {post.image && (
          <div class="parallax-image-wrapper absolute inset-0 w-full h-full">
            {post.image.startsWith('http') ? (
              <img
                src={post.image}
                alt={post.title || 'Post image'}
                class="parallax-image w-[120%] md:w-[133%] h-[120%] md:h-[133%] object-cover"
                loading="lazy"
              />
            ) : (
              <DirectusImage
                imageId={post.image}
                alt={post.title || 'Post image'}
                class="parallax-image w-[120%] md:w-[133%] h-[120%] md:w-[133%] object-cover"
              />
            )}
          </div>
        )}
        
        <!-- Hover Bubble -->
        <div class="hover-bubble absolute w-fit h-12 flex items-center justify-center bg-black/90 text-white px-4 py-2 md:px-6 md:py-3 rounded-full text-sm md:text-base font-medium opacity-0 pointer-events-none z-10 shadow-lg">
          Read this {base === 'project' ? 'Project' : 'Post'}
        </div>
        
        <!-- Clickable Overlay -->
        <Link href={`/${base}/${post.slug}`} class="clickable-overlay absolute inset-0 z-5 cursor-pointer group">
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all duration-300 ease-out"></div>
        </Link>
      </div>
      
      <!-- Content Below Image -->
      <div class="parallax-content text-left max-w-4xl mx-auto">
        <h3 class="parallax-title text-lg md:text-2xl lg:text-3xl font-bold mb-2 md:mb-4 text-gray-900">
          {post.title}
        </h3>
        <p class="parallax-description text-sm md:text-base lg:text-lg mb-3 md:mb-6 text-gray-600 line-clamp-2 md:line-clamp-3">
          {post.description}
        </p>
        <div class="overflow-hidden">
          <Link href={`/${base}/${post.slug}`} class="parallax-link inline-block px-4 py-2 md:px-6 md:py-3 bg-black text-white rounded-full font-medium hover:bg-gray-800 transition-colors text-sm md:text-base">
            Read More
          </Link>
        </div>
      </div>
    </div>
  ))}
</div>

<script>
  import registerParallaxGridHooks from './ParallaxGrid.barba.ts';
  registerParallaxGridHooks();
</script>

<style>
  @keyframes ripple {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }
  
  .ripple-effect {
    animation: ripple 0.6s linear;
  }
  
  .clickable-overlay:hover .parallax-image {
    transform: scale(1.05);
    transition: transform 0.3s ease-out;
  }
  
  .clickable-overlay:active .parallax-image {
    transform: scale(1.02);
    transition: transform 0.1s ease-out;
  }
</style>
